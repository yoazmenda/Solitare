pico-8 cartridge // http://www.pico-8.com
version 42
__lua__

#include Card.lua
#include Deck.lua
#include InputHandler.lua

ms_x = 63
ms_y = 63

deck = {}

deck_x = 14
deck_y = 18

card_width = 16
card_height = 24

deck_clicked = false

is_clicked = {
    left = false,
    right = false,
    middle = false
}
open_card = nil

function _init()
    poke(0x5f2d, 1) -- Enable mouse

    deck = Deck:new()
    input = InputHandler:new()
    open_card = nil
end


function initializeDeck()
    local deck = {}
    local suits = {"h", "d", "c", "s"} -- Hearts, Diamonds, Clubs, Spades
    local values = {"2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K", "A"}

    for _, suit in ipairs(suits) do
        for _, value in ipairs(values) do
            add(deck, Card:new(value, suit))
        end
    end

    return deck
end

function update_mouse()
	-- Update mouse position
	ms_x = stat(32) - 3
	ms_y = stat(33) - 3

	-- Get mouse button states (bitfield)
	local buttons = stat(34)

	-- Update `is_clicked` variables
	is_clicked.left = (buttons & 0x1) != 0
	is_clicked.right = (buttons & 0x2) != 0
	is_clicked.middle = (buttons & 0x4) != 0
end

function update_open_card()
    if is_clicked.left then
        if ms_x >= deck_x and ms_x <= deck_x + card_width and ms_y >= deck_y and ms_y <= deck_y + card_height then
            open_card = drawTopCard(deck)
        end
    end
end

function _update()
    input:update_mouse()
    open_card = input:handle_click(deck, open_card)
    input:handle_drag(open_card)
end


-- Function to check if a point (px, py) is within a rectangle (rx, ry, rw, rh)
function is_point_in_rect(px, py, rx, ry, rw, rh)
    return px >= rx and px <= (rx + rw) and py >= ry and py <= (ry + rh)
end

function _draw()
    cls()
    map(0, 0, 0, 0, 16, 16) -- Draw background
    deck:draw() -- Draw deck

    if open_card then
        open_card:draw()
    end

    -- Draw mouse
    spr(1, input.ms_x, input.ms_y)
end

function drawTopCard(deck)
    local card = deck[#deck] -- Get the top card (last element)
    del(deck, card) -- Remove the top card from the deck
    return card
end


__gfx__
00000000110000000666666666666660333333333333333333333333066666666666666000000000000000000000000000000000000000000000000000000000
00000000171000006677777777777766333b333b33b33333333333b366dddddddddddd6600000000000000000000000000000000000000000000000000000000
007007001771000067777777777777763333333333333333333333336dddddddddddddd600000000000000000000000000000000000000000000000000000000
00077000177710006777777777777776333333333333b33333b333336dddd5ddddd5ddd600000000000000000000000000000000000000000000000000000000
0007700017777100677777777777777633333b3333333333333333336dddddddddddddd600000000000000000000000000000000000000000000000000000000
007007001771100067777777777777763b3333333333333333333b336dddddddddddddd600000000000000000000000000000000000000000000000000000000
00000000011710006777777777777776333333333b33333333b333336dd5ddddd5ddddd600000000000000000000000000000000000000000000000000000000
000000000001100067777777777777763333b3333333333b333333336ddddddddddd5dd600000000000000000000000000000000000000000000000000000000
000000000000000067777777777777767007700777700777000000006dddd5ddddddddd600000000000000000000000000000000000000000000000000000000
000000000000000067777777777777760880088077000077000000006d5dddddd5ddddd600000000000000000000000000000000000000000000000000000000
000000000000000067777777777777760888888070000007000000006dddddddddd5ddd600000000000000000000000000000000000000000000000000000000
000000000000000067777777777777760888888000000000000000006ddddd5dddddddd600000000000000000000000000000000000000000000000000000000
000000000000000067777777777777760888888000000000000000006dddddddddddddd600000000000000000000000000000000000000000000000000000000
000000000000000067777777777777767088880770700707000000006dddddddd5ddd5d600000000000000000000000000000000000000000000000000000000
000000000000000067777777777777767708807777700777000000006dddd5ddddddddd600000000000000000000000000000000000000000000000000000000
0000000000000000677777777777777677700777770000770000000065ddddddddddddd600000000000000000000000000000000000000000000000000000000
000000000000000067777777777777767770077777000077000000006ddddd5dddddddd600000000000000000000000000000000000000000000000000000000
000000000000000067777777777777767708807777000077000000006dddddddddd5ddd600000000000000000000000000000000000000000000000000000000
000000000000000067777777777777767088880706700760000000006dddddddd5ddddd600000000000000000000000000000000000000000000000000000000
000000000000000067777777777777760888888000000000000000006ddd5ddddddd5dd600000000000000000000000000000000000000000000000000000000
000000000000000067777777777777760888888000000000000000006dddddddddddddd600000000000000000000000000000000000000000000000000000000
000000000000000067777777777777767088880706700760000000006d5dddd5dd5ddd5600000000000000000000000000000000000000000000000000000000
000000000000000067777777777777767708807777700777000000006dddddddddddddd600000000000000000000000000000000000000000000000000000000
00000000000000000666666666666660777007777700007700000000066666666666666000000000000000000000000000000000000000000000000000000000
__map__
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040505050505040404040404060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040605050504050506040404060400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040606040505050505060404060400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040606060406050505050405060400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040604060606050504040406060400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040605060605050504040606040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040605040405050404050606040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040406040404040406050406040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040406040404060505050606040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404060505040405050604040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404060606040506060606060504040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404060404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
